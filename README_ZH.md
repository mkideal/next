# Next è¯­è¨€ ğŸš€

[English](./README.md)

Next æ˜¯ä¸€ç§å¼ºå¤§çš„ä»£ç ç”Ÿæˆè¯­è¨€,æ—¨åœ¨è·¨å¤šç§ç¼–ç¨‹è¯­è¨€åˆ›å»ºé«˜åº¦å®šåˆ¶çš„ä»£ç ã€‚å®ƒåˆ©ç”¨çµæ´»çš„æ¨¡æ¿ç³»ç»Ÿå°†é«˜çº§è§„èŒƒè½¬æ¢ä¸ºç‰¹å®šè¯­è¨€çš„å®ç°ã€‚

## âœ¨ ä¸»è¦ç‰¹æ€§

- ğŸŒ ä»å•ä¸€æºä»£ç ç”Ÿæˆå¤šè¯­è¨€ä»£ç 
- ğŸ“ åŸºäº Go çš„ text/template çš„å¼ºå¤§æ¨¡æ¿ç³»ç»Ÿ
- ğŸ§© é€šè¿‡æ¨¡æ¿ç»§æ‰¿å’Œé‡è½½å®ç°çµæ´»çš„å®šåˆ¶
- ğŸ—ï¸ ä¸°å¯Œçš„ç±»å‹ç³»ç»Ÿ,æ”¯æŒç»“æ„ä½“ã€æšä¸¾å’Œå„ç§æ•°æ®ç±»å‹
- ğŸ·ï¸ æ”¯æŒå…ƒæ•°æ®å’Œè‡ªå®šä¹‰çš„æ³¨è§£

## ğŸ› ï¸ æ¨¡æ¿ç³»ç»Ÿ

Next ä½¿ç”¨åŸºäº Go çš„ [text/template](https://pkg.go.dev/text/template/) åŒ…çš„æ¨¡æ¿ç³»ç»Ÿ,å¹¶ä¸ºä»£ç ç”Ÿæˆæ·»åŠ äº†è‡ªå®šä¹‰å¢å¼ºåŠŸèƒ½ã€‚Next ä¸­çš„æ¨¡æ¿ä½¿ç”¨ `.npl` æ–‡ä»¶æ‰©å±•åã€‚

### ğŸ“Š æ¨¡æ¿å±‚æ¬¡ç»“æ„å’Œç»§æ‰¿

Next å®ç°äº†ä¸‰å±‚æ¨¡æ¿å±‚æ¬¡ç»“æ„,ä¾¿äºè‡ªå®šä¹‰å’Œè¦†ç›–é»˜è®¤è¡Œä¸º:

1. Next å†…ç½®åŸºç¡€æ¨¡æ¿: `next/<object_type>`
2. Next å†…ç½®è¯­è¨€ç‰¹å®šæ¨¡æ¿: `next/<lang>/<object_type>`
3. ç”¨æˆ·å®šä¹‰çš„è¯­è¨€ç‰¹å®šæ¨¡æ¿: `<lang>/<object_type>`

è¿™ç§å±‚æ¬¡ç»“æ„å®ç°äº†å¼ºå¤§çš„ç»§æ‰¿å’Œé‡è½½æœºåˆ¶,ç±»ä¼¼äºé¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„ç±»ç»§æ‰¿ã€‚

ä¸»è¦çš„ `<object_type>` å€¼åŒ…æ‹¬:

- `file`: è¡¨ç¤ºæ•´ä¸ªæ–‡ä»¶
- `comment`: ç”¨äºæ³¨é‡Š
- `doc`: ç”¨äºæ–‡æ¡£
- `imports`: ç”¨äºå¯¼å…¥è¯­å¥
- `import`: ç”¨äºå•ä¸ªå¯¼å…¥è¯­å¥
- `specs`: ç”¨äºæ–‡ä»¶ä¸­çš„æ‰€æœ‰è§„èŒƒ
- `consts`: ç”¨äºå¸¸é‡è§„èŒƒ
- `const`: ç”¨äºå•ä¸ªå¸¸é‡å£°æ˜
- `enums`: ç”¨äºæšä¸¾è§„èŒƒ
- `enum`: ç”¨äºæšä¸¾å£°æ˜
- `enum.members`: ç”¨äºæšä¸¾æˆå‘˜é›†åˆ
- `enum.member`: ç”¨äºå•ä¸ªæšä¸¾æˆå‘˜
- `structs`: ç”¨äºç»“æ„ä½“è§„èŒƒ
- `struct`: ç”¨äºç»“æ„ä½“å£°æ˜
- `struct.fields`: ç”¨äºç»“æ„ä½“å­—æ®µé›†åˆ
- `struct.field`: ç”¨äºå•ä¸ªç»“æ„ä½“å­—æ®µ
- `struct.field.type`: ç”¨äºç»“æ„ä½“å­—æ®µç±»å‹
- `struct.field.name`: ç”¨äºç»“æ„ä½“å­—æ®µåç§°

å…¶ä»–å¯¹è±¡ç±»å‹åŒ…æ‹¬: `type.array`, `type.vector`, `type.map`, `type.enum`, `type.struct`, ä»¥åŠå„ç§åŸºæœ¬ç±»å‹ã€‚

æ¸²æŸ“æ¨¡æ¿æ—¶,Next é¦–å…ˆæœç´¢æœ€å…·ä½“çš„æ¨¡æ¿(ç”¨æˆ·å®šä¹‰çš„),ç„¶åå›é€€åˆ°è¯­è¨€ç‰¹å®šçš„æ¨¡æ¿,æœ€åå¦‚æœæ²¡æœ‰æ‰¾åˆ°è¦†ç›–,åˆ™ä½¿ç”¨åŸºç¡€æ¨¡æ¿ã€‚

### ğŸ”‘ å…³é”®æ¨¡æ¿å‡½æ•°

Next æä¾›äº†å‡ ä¸ªå…³é”®çš„æ¨¡æ¿å‡½æ•°:

1. `next`: æ ¹æ®ç»™å®šå¯¹è±¡çš„ç±»å‹å’Œå½“å‰è¯­è¨€ä¸Šä¸‹æ–‡,è‡ªåŠ¨é€‰æ‹©å¹¶æ¸²æŸ“æœ€åˆé€‚çš„æ¨¡æ¿ã€‚
2. `render`: ä½¿ç”¨ç»™å®šæ•°æ®æ˜¾å¼æ¸²æŸ“å‘½åæ¨¡æ¿ã€‚
3. `super`: è°ƒç”¨å±‚æ¬¡ç»“æ„ä¸­çš„çˆ¶æ¨¡æ¿,å…è®¸æ‰©å±•ç°æœ‰æ¨¡æ¿ã€‚
4. `head`: è¾“å‡ºç”Ÿæˆçš„ä»£ç æ³¨é‡Š,ä¾‹å¦‚ `// Code generated by "next v0.0.1"; DO NOT EDIT.`
5. `this`: è¿”å›æ¨¡æ¿å…ƒä¿¡æ¯ä¸­æŒ‡å®šçš„å½“å‰èŠ‚ç‚¹(æ–‡ä»¶ã€å¸¸é‡ã€æšä¸¾æˆ–ç»“æ„ä½“)ã€‚

è¿™äº›å‡½æ•°å…è®¸çµæ´»çš„æ¨¡æ¿ç»„åˆå’Œè¦†ç›–,ä½¿å¾—åœ¨é‡ç”¨ç°æœ‰é€»è¾‘çš„åŒæ—¶è½»æ¾è‡ªå®šä¹‰ä»£ç ç”Ÿæˆã€‚

## ğŸš€ ä½¿ç”¨æ–¹æ³•

ä½¿ç”¨ Next ç”Ÿæˆä»£ç :

```bash
next [é€‰é¡¹] [æºç›®å½•æˆ–/å’Œæ–‡ä»¶... (é»˜è®¤ .)]
```

ä¸»è¦é€‰é¡¹:

- `-T lang=dir|file`: æŒ‡å®šè‡ªå®šä¹‰æ¨¡æ¿ç›®å½•æˆ–æ–‡ä»¶
- `-O lang=dir`: è®¾ç½®ç”Ÿæˆä»£ç çš„è¾“å‡ºç›®å½•
- `-M lang.type=value`: å®šä¹‰ç±»å‹æ˜ å°„

å®Œæ•´è¯¦æƒ…,è¯·è¿è¡Œ `next -h`ã€‚

## ğŸ“ ä»£ç ç”Ÿæˆæœºåˆ¶

1. Next ä½¿ç”¨é€šè¿‡ `-T` å‘½ä»¤è¡Œé€‰é¡¹æŒ‡å®šçš„æ¨¡æ¿ã€‚
2. æ¨¡æ¿å¯ä»¥åœ¨æ–‡ä»¶å¼€å¤´çš„ `{{/* ... */}}` ä¸­åŒ…å«å…ƒå®šä¹‰ã€‚å…ƒå­—æ®µåŒ…æ‹¬:
   - `this`: æŒ‡å®šæ¨¡æ¿é€‚ç”¨çš„èŠ‚ç‚¹ç±»å‹(æ–‡ä»¶ã€å¸¸é‡ã€æšä¸¾ã€ç»“æ„ä½“)(é»˜è®¤: file)
   - `path`: å®šä¹‰è¾“å‡ºæ–‡ä»¶è·¯å¾„(ç›¸å¯¹äº `-O` æŒ‡å®šçš„ç›®å½•)
   - `skip`: æ§åˆ¶æ˜¯å¦è·³è¿‡ä»£ç ç”Ÿæˆ
   - `overwrite`: ç¡®å®šæ˜¯å¦è¦†ç›–ç°æœ‰æ–‡ä»¶(é»˜è®¤: true)
3. å…ƒå­—æ®µå€¼(é™¤ `this` å¤–)å¯ä»¥ä½¿ç”¨æ¨¡æ¿è¡¨è¾¾å¼ã€‚ä¾‹å¦‚:

```
{{/*
this: file
path: {{replace (render "java/package.name" this.Package) "." "/"}}/Constants.java
skip: {{eq 0 (len this.Specs.Consts.List)}}
*/}}
```

4. åœ¨ä»£ç ç”Ÿæˆè¿‡ç¨‹ä¸­,Next éå†è¯­æ³•æ ‘(æ–‡ä»¶ã€å¸¸é‡ã€æšä¸¾ã€ç»“æ„ä½“èŠ‚ç‚¹)ä»¥æ ¹æ® `this` è§„èŒƒæ‰¾åˆ°åŒ¹é…çš„æ¨¡æ¿ã€‚
5. ç„¶åå®ƒæ¸²æŸ“æ¨¡æ¿å¹¶å°†ç”Ÿæˆçš„ä»£ç è¾“å‡ºåˆ°æŒ‡å®šè·¯å¾„ã€‚

## ğŸ“‹ ç¤ºä¾‹

ç»™å®š `user.next` ä¸­çš„ Next è§„èŒƒ:

```next
@next(
    go_package = "github.com/username/repo/demo",
    cpp_namespace = "demo",
    java_package = "com.example.demo"
)
package demo;

const (
    Version = "1.0.0";
    MaxRetries = 3;
    Timeout = MaxRetries * 1000; // å¸¸é‡è¡¨è¾¾å¼
)

enum Color {
    Red = 1 << iota, // 1
    Green,           // 2
    Blue,            // 4
    Yellow,          // 8
}

struct User {
    int64 id;
    string username;
    vector<string> tags;
    map<string, int> scores;
    array<float64, 3> coordinates;
    Color favoriteColor;
}

@message(type=101)
struct LoginRequest {
    string username;
    string password;
}

@message(type=102)
struct LoginResponse {
    string token;
    User user;
}
```

æ³¨æ„: `@next` æ³¨è§£åº”æ”¾åœ¨ `package` å£°æ˜ä¸Šæ–¹ã€‚

ä½¿ç”¨è‡ªå®šä¹‰æ¨¡æ¿æ–‡ä»¶ç”Ÿæˆ C++ ä»£ç :

```bash
next -T cpp=templates/cpp.npl -O cpp=./gen/cpp user.next
```

ä½¿ç”¨è‡ªå®šä¹‰æ¨¡æ¿ç”Ÿæˆ Go ä»£ç :

```bash
next -T go=templates/go.npl -O go=./gen/go user.next
```

ä½¿ç”¨è‡ªå®šä¹‰æ¨¡æ¿æ–‡ä»¶ç”Ÿæˆ Java ä»£ç :

```bash
next -T java=templates/java/ -O java=./gen/java user.next
```

## ğŸ¨ è‡ªå®šä¹‰æ¨¡æ¿

åˆ›å»ºè¯­è¨€ç‰¹å®šçš„æ¨¡æ¿ä»¥è¦†ç›–æˆ–æ‰©å±•å†…ç½®æ¨¡æ¿ã€‚ä»¥ä¸‹æ˜¯ä¸åŒè¯­è¨€çš„ç¤ºä¾‹:

### C++ æ¨¡æ¿ (cpp.npl)

```
{{/*
this: file
path: {{this.Package.Name}}/{{this.Name}}.next.h
*/}}

{{- /* è¦†ç›– "next/cpp/import" */ -}}
{{- define "cpp/import" -}}
#include "../{{.File.Package.Name}}/{{.File.Name}}.next.h"
{{- end -}}

{{- /* è¦†ç›– "next/cpp/struct.fields": åœ¨å­—æ®µåä¸ºæ¯ä¸ªæ¶ˆæ¯æ·»åŠ  'message_type' æ–¹æ³• */ -}}
{{- define "cpp/struct.fields" -}}
{{- super .}}
{{- if .Struct.Annotations.message}}

    static int message_type() { return {{.Struct.Annotations.message.type}}; }
{{- end}}
{{- end -}}

{{head}}

{{next this}}
```

### Go æ¨¡æ¿ (go.npl)

```
{{/*
this: file
path: {{this.Package.Name}}/{{this.Name}}.next.go
skip: {{eq "test" this.Name}}
time: 2024-08-25T23:39:46Z0800
*/}}

{{- /* è¦†ç›– "next/go/struct": åœ¨ç»“æ„ä½“åä¸ºæ¯ä¸ªæ¶ˆæ¯æ·»åŠ  'MessageType' æ–¹æ³• */ -}}
{{- define "go/struct"}}
{{- super .}}
{{- if .Annotations.message}}

func ({{.Name}}) MessageType() int { return {{.Annotations.message.type}} }
{{- end}}
{{- end -}}

{{head}}

{{next this}}
```

### Java æ¨¡æ¿

`java/consts.npl`:

```
{{/*
this: file
path: {{replace (render "java/package.name" this.Package) "." "/"}}/Constants.java
skip: {{eq 0 (len this.Specs.Consts.List)}}
*/}}

{{- define "java/file" -}}
package {{render "java/package.name" .Package}};

{{next .Specs.Consts -}}
{{- end -}}

{{head}}

{{next this}}
```

`java/enum.npl`:

```
{{/*
this: enum
path: {{replace (render "java/package.name" this.Package) "." "/"}}/{{this.Name}}.java
*/}}

{{- define "java/enum" -}}
package {{render "java/package.name" .Package}};

{{super .}}
{{- end -}}

{{head}}

{{next this}}
```

`java/struct.npl`:

```
{{/*
this: struct
path: {{replace (render "java/package.name" this.Package) "." "/"}}/{{this.Name}}.java
*/}}

{{- /* è¦†ç›– "next/java/struct": åœ¨ç»“æ„ä½“ä¹‹å‰æ·»åŠ åŒ…å’Œå¯¼å…¥ */ -}}
{{- define "java/struct" -}}
package {{render "java/package.name" .Package}};

{{next .Decl.File.Imports}}
{{super .}}
{{- end -}}

{{- /* è¦†ç›– "next/java/struct.fields": åœ¨å­—æ®µåä¸ºæ¯ä¸ªæ¶ˆæ¯æ·»åŠ  'MessageType' æ–¹æ³• */ -}}
{{- define "java/struct.fields" -}}
{{- super .}}
{{- if .Struct.Annotations.message}}

    public static int MessageType() { return {{.Struct.Annotations.message.type}}; }
{{- end}}
{{- end -}}

{{head}}

{{next this}}
```

è¿™äº›ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ¨¡æ¿å±‚æ¬¡ç»“æ„å’Œç»§æ‰¿ç³»ç»Ÿæ¥ä¸ºä¸åŒè¯­è¨€è‡ªå®šä¹‰ä»£ç ç”Ÿæˆã€‚

## ğŸ“š å†…ç½®è¯­è¨€æ”¯æŒ

Next åŒ…å«å¤šç§è¯­è¨€çš„å†…ç½®æ¨¡æ¿,åŒ…æ‹¬ C++ã€Goã€Java ç­‰ã€‚è¿™äº›æ¨¡æ¿ä½œä¸ºä»£ç ç”Ÿæˆçš„åŸºç¡€,å¯ä»¥ä½¿ç”¨æ¨¡æ¿å±‚æ¬¡ç»“æ„ç³»ç»Ÿè½»æ¾è‡ªå®šä¹‰æˆ–æ‰©å±•ã€‚

## ğŸ“– æ–‡æ¡£

æœ‰å…³ Next è¯­æ³•å’ŒåŠŸèƒ½çš„è¯¦ç»†ä¿¡æ¯,è¯·å‚é˜…[è¯­è¨€è§„èŒƒ](docs/zh/language_spec.md)ã€‚

## ğŸ“„ è®¸å¯è¯

Next æ ¹æ® [MIT è®¸å¯è¯](LICENSE) å‘å¸ƒã€‚